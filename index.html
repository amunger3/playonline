<!DOCTYPE HTML>
<html lang="en">

  <head>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Play Super Master Mind online</title>
    <meta name="title" content="Play Super Master Mind online">
    <meta name="description" content="Play Super Master Mind / Code breaker online, assisted by a calculator which knows the optimal strategy!">
    <meta name="keywords" content="super master mind, code breaker, game, online, optimal strategy, javascript">

    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- scale for smartphones -->
    
    <link rel="stylesheet" type="text/css" href="style/style.css">
    <script src="common_functions.js"></script>

    <script src='lib/jquery-3.4.1.min.js'></script>
    <script>
      // Animation during page loading:
      // 1) when document is ready
      $(document).ready(function () {
        console.log("(ready)");
        // $(".main").hide(); // hide the main div
      });
      // 2) when all elements of the page are completely loaded
      $(window).on('load', function() {
        console.log("(on load)");
        $(".loading").fadeOut("slow"); // loading div fades out
        // $(".main").fadeIn("slow"); // main div fades in
      });
      // 2') Defense timeout to allow interactions with the page
      setTimeout("console.log('(on load timeout)');$('.loading').fadeOut('slow');", 5000); // loading div fades out

        function makeid() {
          let text = "";
          let possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
          for (let i = 0; i < 5; i++) {
            text += possible.charAt(Math.floor(Math.random() * possible.length));
          }
          return text;
        }

        let firstHomePageAccess = false;
        if (typeof(Storage) !== 'undefined') {
          if (!localStorage.firsthomepageaccessdone) {
            localStorage.firsthomepageaccessdone = "first home page access done";
            firstHomePageAccess = true;
          }
          if (!localStorage.firstaccessid) {
            let firstaccessid = 'HP - ' + makeid() + ' - ' + new Date();
            localStorage.firstaccessid = firstaccessid;
          }
        }

        var firstaccessgeoloc = "fa";
    </script>

  </head>

  <body onunload="console.log('exit...');storeFirstHomePageAccess('home', 444, 777 /* (a too low value here will not work) */, 'debug-out');">

    <div class="loading">
      <img src="img/loading.gif" style='width:5.5rem'><br>
      Loading...
    </div>

    <div id="main">

      <!-- HEADER -->
      <script>write_menu(0);</script>

      <div id="site_content">

        <!-- SIDEBAR -->
        <script>write_sidebar();</script>

        <!-- MAIN CONTENT -->
        <div id="content">

          <script>write_introduction()</script>

          <hr style="height:0.75vh; visibility:hidden;" />
          Fond of this good old game?<br>
          Train your mind by <b><font color="#F00000">playing </font><font color="#FF7700">Super </font><font color="#C0C000">Master </font><font color="#00D000">Mind </font><font color='#0000A8'>online</font></b>, assisted by a calculator which knows the optimal strategy!          
        
          <a href='game.html' onfocus='this.blur()' style="text-decoration:none;"><h3 style="margin-bottom:1vh;margin-top:1vh;"><b><img src="img/Pegs.png" style="width:7rem;border-color:#F00000;margin-right:0.5vw;vertical-align:middle">Play&nbsp;online&nbsp;now!&nbsp;</b></h3>
          <img src="img/SuperMasterMind_game_example.png" style="width:80%;border-color:#F00000;margin-top:4px"><br>
          <img src="img/SuperMasterMind_game_possible_codes_2b.png" style="width:80%;border-color:#F00000;margin-top:4px"></a><br>

          <a name="game_rules"></a>
          <h3>Game rules</h3>
          The goal of the game is to find out a <b>secret code composed of N colors</b> chosen randomly.<br>
          The player makes successive attempts and has to find out the secret code before the maximum number of attempts is exceeded.<br>
          At each attempt, the program will provide feedback by displaying from zero to N pegs next to the code played:<br>
          <ul style='list-style-type:disc;margin:0'>
          <li>a <b>black peg</b> &#x26ab; indicates the existence of a correct color placed in a correct position,</li>
          <li>a <b>white peg</b> &#x26aa; indicates the existence of a correct color placed in a wrong position.</li>
          </ul>
          Once this feedback has been provided, another attempt is made.<br>
          The game ends when the secret code is found, which means the player gets N black pegs, or when the maximum number of attempts is exceeded, in which case the game is lost.<br>
          <hr style="height:0.75vh; visibility:hidden;" />
          <a href="img/SuperMasterMind_rules.png"><img src="img/SuperMasterMind_rules.png" style="width:55%;border-color:#F00000;margin-top:4px;margin-right:4px"><small>click to enlarge</small></a><br>

          <h3>Strategy</h3>
          You can play online directly in your browser. Behind the graphical game board, the program is assisted by a calculator which will give you some hints to find the optimal strategy!
          <hr style="height:0.75vh; visibility:hidden;" />
          Several game modes are possible, from <b>3</b> (very easy) <b>to 7 columns</b> (expert) and from <b>5 to 10 colors</b>.
          <hr style="height:0.75vh; visibility:hidden;" />
          At each stage of the game, the <b>number of possible remaining codes</b> is computed and displayed.
          The associated <b>list of possible codes</b> can also be displayed (once the game is over, otherwise it would be cheating!).
          <hr style="height:0.75vh; visibility:hidden;" />
          The calculator also compares what you played to what the <b>"optimal mathematical strategy"</b> would have played. For each code played,
          it compares "the average number of attempts to find secret codes" which is reachable when an optimal code is played
          to this same average number when your code is played, and then displays the difference next to your code. For example:<br>
          <ul>
          <li><b>+0.00</b> means that what you played was optimal (no difference between your code and the optimal code(s)),</li>
          <li><b>-1.00</b> means that what you played was totally useless (1 attempt was lost, thus -1),</li>
          <li><b>-0.50</b> means that what you played was not optimal: you lost <sup>1</sup>&frasl;<sub>2</sub> attempt on average
          to reach secret codes in comparison to an optimal code. That means that if the optimal strategy reaches
          secret codes in 4 attempts on average, your code (followed by an optimal strategy) will reach them in 4.5 attempts on average.
          Of course, if you are lucky (or intuitive &#x1f603;), this inefficient code may be the secret code, in which case you will win the game instantly!
          </ul>

          <!-- OPTIMAL STRATEGY DETAILS -->
          <script>write_optimal_strategy_details_1();</script>

          <h3>About</h3>
          This program works in Chrome, Firefox, Edge and Safari (on Windows, Mac, Linux, Android or iPhone).<br>
          <hr style="height:0.75vh; visibility:hidden;" />
          Any comments or ideas?<br>See <a href='contact_info.html' onfocus='this.blur()'><b>Contact info</b></a> <a href='contact_info.html' onfocus='this.blur()'><img src="img/email.png" style="vertical-align:middle;width:1.5rem;margin:0px"></a>

        </div>

      </div>

      <!-- FOOTER -->
      <div id="footer">
      </div>

      <script>

        // ***********************
        // Handle page access info
        // ***********************

        function dummy_handle_rsp(e) {
        }

        var last_location_data_used = null;
        var initial_time = new Date().getTime();
        function submitHomePageAccessForm(data, access_type, debug_info) {
          var final_time = new Date().getTime();
          if (final_time - initial_time > 999000) { // 15min+delta max - See (**)
            return;
          }
          var timeStr = String(Math.floor((final_time - initial_time)/1000));
          if (access_type.indexOf(" in") != -1) {
            timeStr = "";
          }
          var countryNameStr = "-";
          if ((data != null) && (typeof data.country_name != 'undefined') && (data.country_name != null)) {
            countryNameStr = String(data.country_name).trim();
          }
          var regionNameStr = "-";
          if ((data != null) && (typeof data.region != 'undefined') && (data.region != null)) {
            regionNameStr = String(data.region).trim();
          }
          var cityNameStr = "-";
          if ((data != null) && (typeof data.city != 'undefined') && (data.city != null)) {
            cityNameStr = String(data.city).trim();
          }
          var ipAddressStr = "-";
          if ((data != null) && (typeof data.ip != 'undefined') && (data.ip != null)) {
            ipAddressStr = String(data.ip).trim();
          }
          var firstAccessIdStr = "-";
          if (typeof(Storage) !== 'undefined') {
            if (localStorage.firstaccessid) {
              firstAccessIdStr = localStorage.firstaccessid;
            }
          }
          var debugStr = "firstgeoloc:" + firstaccessgeoloc + "/" + navigator.userAgent + "/initial: " + initial_time + "/final: " + final_time + "/debug_info:" + debug_info;
          let formStr = 'page=' + access_type + '&' + 'timeonpage=' + timeStr + '&' + 'country=' + countryNameStr + '&region=' + regionNameStr + '&city=' + cityNameStr + '&nbgameswon=' + "" + '&nbgames=' + '&nbcodes=' + '&ipaddress=' + ipAddressStr + '&firstaccessid=' + firstAccessIdStr + '&debug=' + debugStr;
          let my_form_url = 'https://script.google.com/macros/s/AKfycbwHJh1Tz7idd8VQJNdWIqWd-6jMxInhRtqY_O96NN7OvEKiY_ox/exec' + '?';
          my_form_url = my_form_url + formStr + '&';
          my_form_url = my_form_url + 'my_callback_fct=dummy_handle_rsp';
          // console.log(my_form_url);
          // Submit form
          console.log("(jQuery.ajax get/jsonp)");
          jQuery.ajax({
            crossDomain: true,
            url: my_form_url,
            method: "GET",
            dataType: "jsonp"
          })
        }

        function storeFirstHomePageAccess(access_type, timeToWait1, timeToWait2, debug_info) {
          if (firstHomePageAccess) {
            // Keep some time between the 2 potential calls to submitHomePageAccessForm()
            let now = new Date().getTime();
            while(new Date().getTime() < now + timeToWait1){}; // (interface is frozen during this short time)
            if (last_location_data_used != null) {
              submitHomePageAccessForm(last_location_data_used, access_type, debug_info);
            }
            else {
              submitHomePageAccessForm(null, access_type, debug_info);
            }
            // Keep some time between the 2 potential calls to submitHomePageAccessForm()
            now = new Date().getTime();
            while(new Date().getTime() < now + timeToWait2){}; // (interface is frozen during this short time)
          }
        }

        function firstHomePageAccessGeolocFailure(jqxhr, textStatus, error) {
          var errorStr = ("first home page access geolocation failure: " + textStatus + " " + error).trim();
          console.log(errorStr);
          $.getJSON('https://api.ipinfodb.com/v3/ip-city/?key=e61c60ef2fd204e654c2dbe9cd5f4d48c325e6b9ec666a9d76466fab576a9ce6&format=json', function(data_p) {
            firstaccessgeoloc = "fa2";
            /* ipinfodb.com response format:
               - SUCCESS case:
                statusCode	"OK"
                statusMessage	""
                ipAddress	"94.239.111.222"
                countryCode	"FR"
                countryName	"France"
                regionName	"Ile-de-France"
                cityName	"Paris"
                zipCode	"75000"
                latitude	"48.8534"
                longitude	"2.3488"
                timeZone	"+01:00"
              - FAILURE case:
                statusCode	"ERROR"
                statusMessage	"Invalid IP Address."
                ipAddress	"994.239.111.222"
                countryCode	""
                countryName	""
                regionName	""
                cityName	""
                zipCode	""
                latitude	"0"
                longitude	"0"
                timeZone	""
            */
            let converted_data = JSON.stringify(data_p);

            // latitude -> latitude
            // longitude -> longitude
            // countryName -> country_name
            converted_data = converted_data.replace("\"countryName\":", "\"country_name\":");
            // regionName -> region
            converted_data = converted_data.replace("\"regionName\":", "\"region\":");
            // cityName -> city
            converted_data = converted_data.replace("\"cityName\":", "\"city\":");
            // ipAddress -> ip
            converted_data = converted_data.replace("\"ipAddress\":", "\"ip\":");

            last_location_data_used = JSON.parse(converted_data);
            storeFirstHomePageAccess('home', 444, 444 /* (a too low value here will not work) */, 'debug-ok2');
          })
          .fail(function(jqxhr, textStatus, error) { // (jqxhr: XMLHTTPRequest)
            firstaccessgeoloc = "faerr2";
            var errorStr = ("first home page access geolocation retry failure: " + textStatus + " " + error).trim();
            console.log(errorStr);
            storeFirstHomePageAccess('home', 444, 444 /* (a too low value here will not work) */, 'debug-fail');
          })
          .always(function() {
            console.log("(getJSON completed #2)");
          });
        }

        if (firstHomePageAccess) {
          $.getJSON('https://api.ipdata.co/en?api-key=1b31a83f2dc4ead71542c7df3dc4850ce22fed68341a7f3b46ab67b2', function(data) {
            firstaccessgeoloc = "fatmp1";
            last_location_data_used = data;
            if ( ((typeof data.ip != 'undefined') && (data.ip != null) && (String(data.ip).trim().length >= 7 /* 0.0.0.0 */)) // (redundant lines)
                 && ((typeof data.city != 'undefined') && (data.city != null) && (String(data.city).trim().length >= 2)) ) { // (redundant lines)
              firstaccessgeoloc = "fa1";
              storeFirstHomePageAccess('home', 444, 444 /* (a too low value here will not work) */, 'debug-ok1');
            }
            else {
              firstaccessgeoloc = "faerr1a";
              return firstHomePageAccessGeolocFailure("", "manual first home page access geolocation retry due to invalid geolocation data", "");
            }
          }) // to simplify, failure cases are not handled in a more complex way
          .fail(function(jqxhr, textStatus, error) { // (jqxhr: XMLHTTPRequest)
            firstaccessgeoloc = "faerr1b";
            firstHomePageAccessGeolocFailure(jqxhr, textStatus, error);
          })
          .always(function() {
            console.log("(getJSON completed #1)");
          });
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-ini')",        44);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-5s')",       5000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-10s')",     10000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-15s')",     15000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-20s')",     20000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-30s')",     30000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-40s')",     40000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-50s')",     50000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-1min')",    60000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-1min30')",  90000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-2min')",   120000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-2min30')", 150000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-3min')",   180000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-4min')",   240000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-5min')",   300000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-10min')",  600000);
          setTimeout("storeFirstHomePageAccess('home', 0, 0, 'debug-15min')",  900000); // See (**)
        }

      </script>

    </div>

  </body>

</html>